<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<title data-react-helmet="true">Extensions | Kotest</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Extensions | Kotest"><meta data-react-helmet="true" name="description" content="Kotest integrates with many libraries and frameworks. This page outlines the extensions maintained by the Kotest team."><meta data-react-helmet="true" property="og:description" content="Kotest integrates with many libraries and frameworks. This page outlines the extensions maintained by the Kotest team."><meta data-react-helmet="true" property="og:url" content="https://kotest.io/docs/framework/extensions.html"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://kotest.io/docs/framework/extensions.html"><link rel="stylesheet" href="/styles.93f68e79.css">
<link rel="preload" href="/styles.606e2f0a.js" as="script">
<link rel="preload" href="/runtime~main.359e8858.js" as="script">
<link rel="preload" href="/main.b76abbce.js" as="script">
<link rel="preload" href="/1.9e8a5b4c.js" as="script">
<link rel="preload" href="/68.11a67fef.js" as="script">
<link rel="preload" href="/69.e43b4770.js" as="script">
<link rel="preload" href="/935f2afb.97d02164.js" as="script">
<link rel="preload" href="/67.8af7cec2.js" as="script">
<link rel="preload" href="/775d8d04.dbe01311.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a><a class="navbar__item navbar__link" href="/docs/quickstart">Overview</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/framework/framework.html">Framework</a><a class="navbar__item navbar__link" href="/docs/assertions/assertions.html">Assertions</a><a class="navbar__item navbar__link" href="/docs/proptest/property-based-testing.html">Property Testing</a><a class="navbar__item navbar__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Issue Tracker</a><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/logo.png" alt="Kotest" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Kotest</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/quickstart">Overview</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/framework/framework.html">Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/assertions/assertions.html">Assertions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/proptest/property-based-testing.html">Property Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/intellij/intellij-plugin.html">Intellij Plugin</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest/issues" target="_blank" rel="noopener noreferrer" class="menu__link">Issue Tracker</a></li><li class="menu__list-item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/framework/framework.html">Test Framework</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/testing-styles.html">Testing Styles</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/conditional-evaluation.html">Conditional Evaluation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/isolation-mode.html">Isolation Modes</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/exceptions.html">Exceptions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/data-driven-testing.html">Data Driven Testing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/listeners.html">Listeners</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/framework/extensions.html">Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/mocking.html">Mocking and Kotest</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Ordering</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/spec-ordering.html">Spec Ordering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/test-ordering.html">Test Ordering</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/tags.html">Grouping Tests with Tags</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Resources</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/autoclose.html">Closing resources automatically</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/temporary-files">Temporary Files</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/testcaseconfig.html">Test Case Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/project-config.html">Project Level Config</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/framework/framework-config-props.html">System properties</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/test-extensions.html">Test Extensions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/test-factories.html">Test Factories</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/framework/timeouts.html">Timeouts</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Extensions</h1></header><div class="markdown"><p>Kotest integrates with many libraries and frameworks. This page outlines the extensions maintained by the Kotest team.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="allure"></a>Allure<a class="hash-link" href="#allure" title="Direct link to heading">#</a></h2><p><a href="http://allure.qatools.ru" target="_blank" rel="noopener noreferrer">Allure</a> is an open-source framework designed to generate detailed and interactive test reports.
It works by collecting test data as tests are executed and then compiling that into a final HTML report.</p><p>Kotest provides an extenstion for Allure and full integration instructions are <a href="/docs/framework/extensions/allure">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="spring"></a>Spring<a class="hash-link" href="#spring" title="Direct link to heading">#</a></h2><p>Kotest offers a Spring extension that allows you to test code that wires dependencies using Spring.
To use this extension add the <code>kotest-extensions-spring</code> module to your test compile path.</p><p>In order to let Spring know which configuration class to use, you must annotate your Spec classes with <code>@ContextConfiguration</code>.
This should point to a class annotated with the Spring <code>@Configuration</code> annotation. Alternatively, you can use <code>@ActiveProfile</code> to
point to a <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-profiles.html" target="_blank" rel="noopener noreferrer">specific application context file</a>.</p><p>There are two ways to enable spring wiring depending on if you want to use constructor injection, or field injection.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="field-injection"></a>Field Injection<a class="hash-link" href="#field-injection" title="Direct link to heading">#</a></h3><p>If you wish to use field injection, then the <code>SpringListener</code> must be registered with any
Spec that uses spring beans. For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@ContextConfiguration(classes = [(TestConfiguration::class)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class SpringExampleSpec : WordSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun listeners() = listOf(SpringListener)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  @Autowired</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var bean: MyBean? = null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Spring Extension&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;have wired up the bean&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        bean shouldNotBe null</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>You could add the <code>SpringListener</code> project wide by registering the listener in <a href="/docs/framework/project-config.html">ProjectConfig</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="constructor-injection"></a>Constructor Injection<a class="hash-link" href="#constructor-injection" title="Direct link to heading">#</a></h3><p>For constructor injection, we use a different implementation called <code>SpringAutowireConstructorExtension</code> which
must be registered with <a href="/docs/framework/project-config.html">ProjectConfig</a>. This extension will intercept each call to create a Spec instance
and will autowire the beans declared in the primary constructor.</p><p>First an example of the project config.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProjectConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun extensions(): List&lt;Extension&gt; = listOf(SpringAutowireConstructorExtension)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And now an example of a test class which requires a service called <code>UserService</code> in its primary constructor. This service
class is just a regular spring bean which has been annotated with @Component.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@ContextConfiguration(classes = [(Components::class)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class SpringAutowiredConstructorTest(service: UserService) : WordSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;SpringListener&quot; should {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;have autowired the service&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        service.repository.findUser().name shouldBe &quot;system_user&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="final-clases"></a>Final Clases<a class="hash-link" href="#final-clases" title="Direct link to heading">#</a></h3><p>When using a final class, you may receive a warning from Kotest:</p><p><code>Using SpringListener on a final class. If any Spring annotation fails to work, try making this class open</code></p><p>If you wish, you can disable this warning by setting the system property <code>kotest.listener.spring.ignore.warning</code> to true.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ktor"></a>Ktor<a class="hash-link" href="#ktor" title="Direct link to heading">#</a></h2><p>The <code>kotest-assertions-ktor</code> module provides response matchers for a <a href="https://ktor.io" target="_blank" rel="noopener noreferrer">Ktor</a> application. There are matchers
for both <code>TestApplicationResponse</code> if you are using the server side test support, and for <code>HttpResponse</code> if you are using the ktor
client classes.</p><p>To add Ktor matchers, add the following dependency to your project</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-groovy codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">testImplementation(&quot;io.kotest:kotest-assertions-ktor:${version}&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>An example of using the matchers with the server side test support:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">withTestApplication({ module(testing = true) }) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   handleRequest(HttpMethod.Get, &quot;/&quot;).apply {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      response shouldHaveStatus HttpStatusCode.OK</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      response shouldNotHaveContent &quot;failure&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      response.shouldHaveHeader(name = &quot;Authorization&quot;, value = &quot;Bearer&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      response.shouldNotHaveCookie(name = &quot;Set-Cookie&quot;, cookieValue = &quot;id=1234&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And an example of using the client support:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val client = HttpClient(CIO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">val resp = client.post(&quot;http://mydomain.com/foo&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">response.shouldHaveStatus(HttpStatusCode.OK)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">response.shouldHaveHeader(name = &quot;Authorization&quot;, value = &quot;Bearer&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="koin"></a>Koin<a class="hash-link" href="#koin" title="Direct link to heading">#</a></h2><p>The <a href="https://insert-koin.io/" target="_blank" rel="noopener noreferrer">Koin DI Framework</a> can be used with Kotest through the <code>KoinListener</code> test listener and its own interface <code>KoinTest</code>.</p><p>To add the listener to your project, add the depency to your project:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-groovy codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">testImplementation(&quot;io.kotest:kotest-extensions-koin:${version}&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>With the dependency added, we can use Koin in our tests!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class KotestAndKoin : FunSpec(), KoinTest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun listeners() = listOf(KoinListener(myKoinModule))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    val userService by inject&lt;UserService&gt;()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      test(&quot;Use user service&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        userService.getUser().username shouldBe &quot;Kerooker&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="robolectric"></a>Robolectric<a class="hash-link" href="#robolectric" title="Direct link to heading">#</a></h2><p><a href="http://robolectric.org/" target="_blank" rel="noopener noreferrer">Robolectric</a> can be used with Kotest through the <code>RobolectricExtension</code> which can be found in <code>kotest-extensions-robolectric</code> module.</p><p>To add this module to project you need specify following in your <code>build.gradle</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-groovy codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">testImplementation &#x27;io.kotest:kotest-extensions-robolectric:&lt;version&gt;&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>With this dependency added you should add extensions to your project config. For example if you have no such config yet it would look like</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyProjectLevelConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun extensions(): List&lt;Extension&gt; = super.extensions() + RobolectricExtension()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Of course you can just add this extension to another extensions you&#x27;re already using.</p><p>After that done any class which should be ran with Robolectric should be annotated with <code>@RobolectricTest</code> annotation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="compilation-test"></a>Compilation test<a class="hash-link" href="#compilation-test" title="Direct link to heading">#</a></h2><p>The <code>kotest-assertions-compiler</code> extension provides matchers to assert that given kotlin code snippet compiles or not.
This extension is a wrapper over <a href="https://github.com/tschuchortdev/kotlin-compile-testing" target="_blank" rel="noopener noreferrer">kotlin-compile-testing</a> and provides following matchers</p><ul><li>String.shouldCompile()</li><li>String.shouldNotCompile()</li><li>File.shouldCompile()</li><li>File.shouldNotCompile()</li></ul><p>To add the compilation matcher, add the following dependency to your project</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-groovy codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">testImplementation(&quot;io.kotest:kotest-assertions-compiler:${version}&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Usage:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class CompilationTest: StringSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;shouldCompile test&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                val codeSnippet = &quot;&quot;&quot; val aString: String = &quot;A valid assignment&quot; &quot;&quot;&quot;.trimMargin()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                codeSnippet.shouldCompile()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                File(&quot;SourceFile.kt&quot;).shouldCompile()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;shouldNotCompile test&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                val codeSnippet = &quot;&quot;&quot; val aInteger: Int = &quot;A invalid assignment&quot; &quot;&quot;&quot;.trimMargin()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                codeSnippet.shouldNotCompile()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                File(&quot;SourceFile.kt&quot;).shouldNotCompile()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>During checking of code snippet compilation the classpath of calling process is inherited, which means any dependencies which are available in calling process will also be available while compiling the code snippet.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-extensions"></a>System Extensions<a class="hash-link" href="#system-extensions" title="Direct link to heading">#</a></h2><p>Sometimes your code might use some functionalities straight from the JVM, which are very hard to simulate. With Kotest System Extensions, these difficulties are made easy to mock and simulate, and your code can be tested correctly. After changing the system and using the extensions, the previous state will be restored.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>This code is sensitive to concurrency. Due to the JVM specification there can only be one instance of these extensions running (For example: Only one Environment map must exist). If you try to run more than one instance at a time, the result is unknown.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-environment"></a>System Environment<a class="hash-link" href="#system-environment" title="Direct link to heading">#</a></h3><p>With <em>System Environment Extension</em> you can simulate how the System Environment is behaving. That is, what you&#x27;re obtaining from <code>System.getenv()</code>.</p><p>Kotest provides some extension functions that provides a System Environment in a specific scope:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">withEnvironment(&quot;FooKey&quot;, &quot;BarValue&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.getenv(&quot;FooKey&quot;) shouldBe &quot;BarValue&quot; // System environment overriden!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>You can also use multiple values in this extension, through a map or list of pairs.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">withEnvironment(mapOf(&quot;FooKey&quot; to &quot;BarValue&quot;, &quot;BarKey&quot; to &quot;FooValue&quot;)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // Use FooKey and BarKey</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>These functions will add the keys and values if they&#x27;re not currently present in the environment, and will override them if they are. Any keys untouched by the function will remain in the environment, and won&#x27;t be messed with.</p><p>Instead of extensions functions, you can also use the provided Listeners to apply these functionalities in a bigger scope. There&#x27;s an alternative for the Spec/Per test level, and an alternative for the Project Level.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTest : FreeSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      override fun listeners() = listOf(SystemEnvironmentTestListener(&quot;foo&quot;, &quot;bar&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;MyTest&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        System.getenv(&quot;foo&quot;) shouldBe &quot;bar&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class ProjectConfig : AbstractProjectConfig() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun listeners(): List&lt;TestListener&gt; = listOf(SystemEnvironmentProjectListener(&quot;foo&quot;, &quot;bar&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-property-extension"></a>System Property Extension<a class="hash-link" href="#system-property-extension" title="Direct link to heading">#</a></h3><p>In the same fashion as the Environment Extensions, you can override the System Properties (<code>System.getProperties()</code>):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">withSystemProperty(&quot;foo&quot;, &quot;bar&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  System.getProperty(&quot;foo&quot;) shouldBe &quot;bar&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And with similar Listeners:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class MyTest : FreeSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          override fun listeners() = listOf(SystemPropertyListener(&quot;foo&quot;, &quot;bar&quot;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;MyTest&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            System.getProperty(&quot;foo&quot;) shouldBe &quot;bar&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-security-manager"></a>System Security Manager<a class="hash-link" href="#system-security-manager" title="Direct link to heading">#</a></h3><p>Similarly, with System Security Manager you can override the System Security Manager (<code>System.getSecurityManager()</code>)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    withSecurityManager(myManager) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // Usage of security manager</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And the Listeners:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class MyTest : FreeSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              override fun listeners() = listOf(SecurityManagerListener(myManager))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              // Use my security manager</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="system-exit-extensions"></a>System Exit Extensions<a class="hash-link" href="#system-exit-extensions" title="Direct link to heading">#</a></h3><p>Sometimes you want to test that your code calls <code>System.exit</code>. For that you can use the <code>System Exit Listeners</code>. The Listener will throw an exception when the <code>System.exit</code> is called, allowing you to catch it and verify:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class MyTest : FreeSpec() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun listeners() = listOf(SpecSystemExitListener)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  init {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Catch exception&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      val thrown: SystemExitException = shouldThrow&lt;SystemExitException&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        System.exit(22)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      thrown.exitCode shouldBe 22</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="no-stdout--no-stderr-listeners"></a>No-stdout / no-stderr listeners<a class="hash-link" href="#no-stdout--no-stderr-listeners" title="Direct link to heading">#</a></h3><p>Maybe you want to guarantee that you didn&#x27;t leave any debug messages around, or that you&#x27;re always using a Logger in your logging.</p><p>For that, Kotest provides you with <code>NoSystemOutListener</code> and <code>NoSystemErrListener</code>. These listeners won&#x27;t allow any messages to be printed straight to <code>System.out</code> or <code>System.err</code>, respectively:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // In Project or in Spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun listeners() = listOf(NoSystemOutListener, NoSystemErrListener)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="localetimezone-listeners"></a>Locale/Timezone listeners<a class="hash-link" href="#localetimezone-listeners" title="Direct link to heading">#</a></h3><p>Some codes use and/or are sensitive to the default Locale and default Timezone. Instead of manipulating the system defaults no your own,
let Kotest do it for you!</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">withDefaultLocale(Locale.FRANCE) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  println(&quot;My locale is now France! TrÃ¨s bien!&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">withDefaultTimezone(TimeZone.getTimeZone(ZoneId.of(&quot;America/Sao_Paulo&quot;))) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  println(&quot;My timezone is now America/Sao_Paulo! Muito bem!&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And with the listeners</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // In Project or in Spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun listeners() = listOf(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    LocaleTestListener(Locale.FRANCE),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    TimeZoneTestListener(TimeZone.getTimeZone(ZoneId.of(&quot;America/Sao_Paulo&quot;)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="current-instant-listeners"></a>Current instant listeners<a class="hash-link" href="#current-instant-listeners" title="Direct link to heading">#</a></h3><p>Sometimes you may want to use the <code>now</code> static functions located in <code>java.time</code> classes for multiple reasons, such as setting the creation date of an entity</p><p><code>data class MyEntity(creationDate: LocalDateTime = LocalDateTime.now())</code>.</p><p>But what to do when you want to test that value? <code>now</code> will be different
each time you call it!</p><p>For that, Kotest provides <code>ConstantNowListener</code> and <code>withConstantNow</code> functions.</p><p>While executing your code, your <code>now</code> will always be the value that you want to test against.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val foreverNow = LocalDateTime.now()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">withConstantNow(foreverNow) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LocalDateTime.now() shouldBe foreverNow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  delay(10) // Code is taking a small amount of time to execute, but `now` changed!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  LocalDateTime.now() shouldBe foreverNow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Or, with a listener for all the tests:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun listeners() = listOf(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ConstantNowTestListener(foreverNow)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p><code>withContantNow</code> and <code>ConstantNowTestListener</code> are very sensitive to race conditions. Using them, mocks the static method <code>now</code> which is global to the whole JVM instance,
if you&#x27;re using it while running test in parallel, the results may be inconsistent.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="junit-format-xml-report"></a>JUnit Format XML Report<a class="hash-link" href="#junit-format-xml-report" title="Direct link to heading">#</a></h2><p>JUnit includes an XML report generator that it calls the <a href="https://junit.org/junit5/docs/5.5.0-RC2/api/org/junit/platform/reporting/legacy/xml/LegacyXmlReportGeneratingListener.html" target="_blank" rel="noopener noreferrer">legacy xml report</a>. Many tools integrate with this format so it is very useful.
However, this report has no concept of nesting tests. Therefore when used with a nested <a href="/docs/framework/testing-styles.html">test style</a> in Kotest, it will include parent tests as orphans.</p><p>To solve this, Kotest has it&#x27;s own <a href="/docs/framework/extensions/junit_xml">implementation of the same format</a>, that is configurable on whether to include parent tests and/or collapse the names.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="mockserver"></a>MockServer<a class="hash-link" href="#mockserver" title="Direct link to heading">#</a></h2><p>Kotest provides an extension for integration with the <a href="https://www.mock-server.com" target="_blank" rel="noopener noreferrer">MockServer</a> library through the <code>kotest-extensions-mockserver</code> module.</p><p>MockServer is described as an in process server that returns specific responses for different requests via HTTP or HTTPS.
When MockServer receives a request it matches that request against the configured expectations. If a match is found it returns that response, otherwise a 404 is returned.</p><p>Read <a href="/docs/framework/extensions/mockserver">full instructions here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testcontainers"></a>TestContainers<a class="hash-link" href="#testcontainers" title="Direct link to heading">#</a></h2><p><a href="https://github.com/testcontainers/testcontainers-java" target="_blank" rel="noopener noreferrer">testcontainers-java</a> library that provide lightweight, throwaway instances of common databases, Selenium web browsers, or anything else that can run in a Docker container.</p><p><code>kotest-extensions-testcontainers</code> provides integration for using testcontainers-java with kotest.</p><p>For using <code>kotest-extensions-testcontainers</code> add the below dependency in your build file.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-groovy codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">testImplementation(&quot;io.kotest:kotest-extensions-testcontainers:${version}&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Having this dependency in test classpath brings in extension method&#x27;s in scope which let you convert any Startable such as a DockerContainer into a kotest TestListener, which you can register with Kotest and then Kotest will manage lifecycle of container for you.</p><p>For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-kotlin codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">class DatabaseRepositoryTest : FunSpec({</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   val redisContainer = GenericContainer&lt;Nothing&gt;(&quot;redis:5.0.3-alpine&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   listener(redisContainer.perTest()) //converts container to listener and registering it with Kotest.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   test(&quot;some test which assume to have redis container running&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">})</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>In above example <code>perTest()</code> extension method converts the container into a <code>TestListener</code> which start&#x27;s the
redis container before each test and stop&#x27;s that after test. Similarly if you want to reuse the container for all tests
in a single spec class you can use <code>perSpec()</code> extension method which convert&#x27;s container into a <code>TestListener</code>
which start&#x27;s the container before running any test in spec and stop&#x27;s that after all tests, thus a single container is
used by all tests in spec class.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/kotest/kotest/docs/framework/extensions.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/framework/listeners.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Listeners</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/framework/mocking.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mocking and Kotest Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#allure" class="table-of-contents__link">Allure</a></li><li><a href="#spring" class="table-of-contents__link">Spring</a><ul><li><a href="#field-injection" class="table-of-contents__link">Field Injection</a></li><li><a href="#constructor-injection" class="table-of-contents__link">Constructor Injection</a></li><li><a href="#final-clases" class="table-of-contents__link">Final Clases</a></li></ul></li><li><a href="#ktor" class="table-of-contents__link">Ktor</a></li><li><a href="#koin" class="table-of-contents__link">Koin</a></li><li><a href="#robolectric" class="table-of-contents__link">Robolectric</a></li><li><a href="#compilation-test" class="table-of-contents__link">Compilation test</a></li><li><a href="#system-extensions" class="table-of-contents__link">System Extensions</a><ul><li><a href="#system-environment" class="table-of-contents__link">System Environment</a></li><li><a href="#system-property-extension" class="table-of-contents__link">System Property Extension</a></li><li><a href="#system-security-manager" class="table-of-contents__link">System Security Manager</a></li><li><a href="#system-exit-extensions" class="table-of-contents__link">System Exit Extensions</a></li><li><a href="#no-stdout--no-stderr-listeners" class="table-of-contents__link">No-stdout / no-stderr listeners</a></li><li><a href="#localetimezone-listeners" class="table-of-contents__link">Locale/Timezone listeners</a></li><li><a href="#current-instant-listeners" class="table-of-contents__link">Current instant listeners</a></li></ul></li><li><a href="#junit-format-xml-report" class="table-of-contents__link">JUnit Format XML Report</a></li><li><a href="#mockserver" class="table-of-contents__link">MockServer</a></li><li><a href="#testcontainers" class="table-of-contents__link">TestContainers</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://kotlinlang.slack.com/archives/CT0G9SD7Z" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://github.com/kotest/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/kotest" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 Kotest, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.606e2f0a.js"></script>
<script src="/runtime~main.359e8858.js"></script>
<script src="/main.b76abbce.js"></script>
<script src="/1.9e8a5b4c.js"></script>
<script src="/68.11a67fef.js"></script>
<script src="/69.e43b4770.js"></script>
<script src="/935f2afb.97d02164.js"></script>
<script src="/67.8af7cec2.js"></script>
<script src="/775d8d04.dbe01311.js"></script>
</body>
</html>